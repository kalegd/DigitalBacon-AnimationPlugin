const{Assets:e,DigitalBaconUI:t,ProjectHandler:s,THREE:r,dynamicAssets:i,getMenuController:a,isEditor:o}=window.DigitalBacon,{CustomAssetEntity:n}=e,l=[new r.Vector3,new r.Vector3],d=new t.Style({materialColor:6514283});class AnimationController extends n{constructor(e={}){e.assetId=AnimationController.assetId,super(e),o()&&(this._createMesh(),window.ac=this)}_getDefaultName(){return AnimationController.assetName}_createMesh(){let e=new t.Body({height:.3,materialColor:0,width:.45}),s=new t.Div({backgroundVisible:!0,borderRadius:.01,height:.035,justifyContent:"center",materialColor:9868950,width:.3}),r=new t.Text("Start Preview",{color:16777215,fontSize:.019});s.add(r),e.add(s),this._object.add(e),s.onClickAndTouch=()=>this._startPreview(),s.pointerInteractable.addHoveredCallback((e=>{e?s.addStyle(d):s.removeStyle(d)}))}setPositionFromMenu(){let e=a();e.getPosition(l[0]),e.getDirection(l[1]).normalize().divideScalar(4),l[0].sub(l[1]).roundWithPrecision(5);let t=l[0].toArray();this.position=t,this.parent.object.worldToLocal(this.object.position)}registerAnimationPathClass(e){this._animationPathClass=e}_startPreview(){let e=s.getAssets();this._pathAssets=[],this._maxTime=0;for(let t in e)"2d227485-0b34-40a4-873d-2a0782d034c6"==e[t].assetId&&(this._pathAssets.push(e[t]),this._maxTime=Math.max(this._maxTime,e[t]._maxTime));0!=this._pathAssets.length&&(this._time=0,this._reverse=!1,i.add(this))}update(e){this._time+=this._reverse?-e:e,this._time>this._maxTime?this._reverse=!0:this._time<0&&(this._time=0);for(let e of this._pathAssets)e._setTime(this._time);0==this._time&&i.delete(this)}static assetId="d4706106-d21d-4933-a665-6c5f3b6cb383";static assetName="Animation Controller";static isPrivate=!0}const{Assets:p,EditorHelpers:c}=window.DigitalBacon,{CustomAsset:m}=p,{CustomAssetHelper:h,EditorHelperFactory:u}=c,{EnumField:_}=h.FieldTypes,f={Linear:"linear",Sinusoidal:"sinusoidal",Quadratic:"quadratic",Cubic:"cubic",Quartic:"quartic",Quintic:"quintic",Exponential:"exponential",Circular:"circular",Back:"back",Bounce:"bounce",Elastic:"elastic",Step:"step"},g={"Ease In":"easeIn","Ease Out":"easeOut","Ease In & Out":"easeInOut"};class Interpolation extends m{constructor(e={}){super(e),this._parameter=e.parameter,this._type=e.type||"linear",this._easing=e.easing||"easeInOut"}_getDefaultName(){return Interpolation.assetName}exportParams(){let e=super.exportParams();return e.parameter=this._parameter,e.type=this._type,e.easing=this._easing,e}get parameter(){return this._parameter}get type(){return this._type}get easing(){return this._easing}set parameter(e){this._parameter=e}set type(e){this._type=e}set easing(e){this._easing=e}registerKeyframe(e){this._keyframe=e}getValue(e,t){if(!this._keyframe)return;if(!t||e<=this._keyframe.time)return this._keyframe[this._parameter];if(e>=t.time)return t[this._parameter];let s=(e-this._keyframe.time)/(t.time-this._keyframe.time);if("sinusoidal"==this._type)s=this._getSinusoidalTime(s);else if("quadratic"==this._type)s=this._getPolynomialTime(s,2);else if("cubic"==this._type)s=this._getPolynomialTime(s,3);else if("quartic"==this._type)s=this._getPolynomialTime(s,4);else if("quintic"==this._type)s=this._getPolynomialTime(s,5);else if("exponential"==this._type)s=this._getExponentialTime(s);else if("circular"==this._type)s=this._getCircularTime(s);else if("back"==this._type)s=this._getBackTime(s);else if("bounce"==this._type)s=this._getBounceTime(s);else if("elastic"==this._type)s=this._getElasticTime(s);else if("linear"!=this._type)return this._getStepValue(s,t);return this._getLinearValue(s,t)}_getSinusoidalTime(e){return"easeIn"==this._easing?1-Math.cos(e*Math.PI/2):"easeOut"==this._easing?Math.sin(e*Math.PI/2):.5*(1-Math.cos(e*Math.PI))}_getPolynomialTime(e,t){return"easeIn"==this._easing?e**t:"easeOut"==this._easing?1-(1-e)**t:e<.5?2**(t-1)*e**t:1-(-2*e+2)**t/2}_getExponentialTime(e){return 0==e?0:1==e?1:"easeIn"==this._easing?2**(10*(e-1)):"easeOut"==this._easing?1-2**(-10*e):e<.5?.5*2**(10*(2*e-1)):1-.5*2**(-10*(2*e-1))}_getCircularTime(e){return"easeIn"==this._easing?1-Math.sqrt(1-e*e):"easeOut"==this._easing?Math.sqrt(e*(2-e)):e<.5?(1-Math.sqrt(1-4*e**2))/2:(Math.sqrt(1-(-2*e+2)**2)+1)/2}_getBackTime(e){let t=1.70158;if("easeIn"==this._easing){return(t+1)*e**3-t*e**2}if("easeOut"==this._easing){return 1+(t+1)*(e-1)**3+t*(e-1)**2}if(e<.5){let s=1.525*t;return(2*e)**2*(2*(s+1)*e-s)/2}{let s=1.525*t;return((2*e-2)**2*((s+1)*(2*e-2)+s)+2)/2}}_getBounceTime(e){return"easeIn"==this._easing?1-this._getEaseOutBounce(1-e):"easeOut"==this._easing?this._getEaseOutBounce(e):e<.5?(1-this._getEaseOutBounce(1-2*e))/2:(1+this._getEaseOutBounce(2*e-1))/2}_getEaseOutBounce(e){let t=7.5625,s=2.75;return e<1/s?t*e*e:e<2/s?t*(e-1.5/s)**2+.75:e<2.5/s?t*(e-2.25/s)**2+.9375:t*(e-2.625/s)**2+.984375}_getElasticTime(e){let t=2*Math.PI/3,s=2*Math.PI/4.5;return 0==e?0:1==e?1:"easeIn"==this._easing?-(2**(10*e-10))*Math.sin((10*e-10.75)*t):"easeOut"==this._easing?2**(-10*e)*Math.sin((10*e-.75)*t)+1:e<.5?2**(20*e-10)*Math.sin((20*e-11.125)*s)/-2:2**(-20*e+10)*Math.sin((20*e-11.125)*s)/2+1}_getLinearValue(e,t){console.error("_getLinearValue(...) should be overwritten")}_getStepValue(e){return e<1?this._keyframe[this._parameter]:nextKeyframe[this._parameter]}static assetName="Interpolation";static isPrivate=!0}class InterpolationHelper extends h{constructor(e){super(e)}static fields=[{parameter:"type",name:"Interpolation Type",map:f,type:_},{parameter:"easing",name:"Easing",map:g,type:_}]}u.registerEditorHelper(InterpolationHelper,Interpolation);const{LibraryHandler:y,ProjectHandler:P}=window.DigitalBacon;class ColorInterpolation extends Interpolation{constructor(e={}){e.assetId=ColorInterpolation.assetId,super(e)}_getDefaultName(){return ColorInterpolation.assetName}_getLinearValue(e,t){let{r:s,g:r,b:i}=this._hexToRGB(this._keyframe[this._parameter]),{r:a,g:o,b:n}=this._hexToRGB(t[this._parameter]),l=Math.round(s+(a-s)*e),d=Math.round(r+(o-r)*e),p=Math.round(i+(n-i)*e);return this._rgbToHex(l,d,p)}_hexToRGB(e){return{r:e>>16&255,g:e>>8&255,b:255&e}}_rgbToHex(e,t,s){return e<<16|t<<8|s}static assetId="2889a453-7a29-465f-9542-f8ad01156cb8";static assetName="Color Interpolation";static isPrivate=!0}P.registerAsset(ColorInterpolation),y.loadPrivate(ColorInterpolation);const{LibraryHandler:I,ProjectHandler:b,THREE:v}=window.DigitalBacon;new v.Euler;const A=[new v.Quaternion,new v.Quaternion];class EulerInterpolation extends Interpolation{constructor(e={}){e.assetId=EulerInterpolation.assetId,super(e)}_getDefaultName(){return EulerInterpolation.assetName}exportParams(){return super.exportParams()}_getLinearValue(e,t){return workingEulers[0].fromArray(this._keyframe[this._parameter]),workingEulers[1].fromArray(t[this._parameter]),A[0].setFromEuler(workingEulers[0]),A[1].setFromEuler(workingEulers[1]),A[0].slerp(A[1],e),workingEulers[0].setFromQuaternion(A[0]),workingEulers[0].toArray()}static assetId="02fc385c-c981-445f-a448-4ea2b5729953";static assetName="Euler Interpolation";static isPrivate=!0}b.registerAsset(EulerInterpolation),I.loadPrivate(EulerInterpolation);const{LibraryHandler:E,ProjectHandler:w}=window.DigitalBacon;class NumberInterpolation extends Interpolation{constructor(e={}){e.assetId=NumberInterpolation.assetId,super(e)}_getDefaultName(){return NumberInterpolation.assetName}_getLinearValue(e,t){return(t[this._parameter]-this._keyframe[this._parameter])*e+this._keyframe[this._parameter]}static assetId="e89be085-ee97-4702-bf2c-01ec0505a694";static assetName="Number Interpolation";static isPrivate=!0}w.registerAsset(NumberInterpolation),E.loadPrivate(NumberInterpolation);const{Assets:x,EditorHelpers:T,LibraryHandler:F,ProjectHandler:H,PubSub:C,THREE:j,getMenuController:k,isEditor:S,utils:M}=window.DigitalBacon,{CustomAssetEntity:N}=x,{CustomAssetEntityHelper:B,EditorHelperFactory:V}=T;B.FieldTypes;const L=[new j.Vector3,new j.Vector3];var D,K;class ControlPoint extends N{constructor(e={}){e.assetId=ControlPoint.assetId,super(e),this._createMesh(),e.position||this._setPositionFromMenu(),S()&&(this._lastPosition=this.position,this.update=this._editorUpdate)}_createMesh(){S()&&(D||(D=new j.SphereGeometry(.025),K=new j.MeshBasicMaterial({color:16711680})),this._mesh=new j.Mesh(D,K),this._object.add(this._mesh))}_getDefaultName(){return ControlPoint.assetName}_setPositionFromMenu(){let e=k();e.getPosition(L[0]),e.getDirection(L[1]).normalize().divideScalar(4),L[0].sub(L[1]).roundWithPrecision(5);let t=L[0].toArray();this.position=t,this.parent.object.worldToLocal(this.object.position)}registerInterpolation(e){this._object.visible=!0,this._interpolation=e,this.parentId=e._keyframe?._animationPath?.id,this.visualEdit=e._keyframe?.visualEdit}unregisterInterpolation(e){e==this._interpolation&&(this._object.visible=!1,this._interpolation=null,this.visualEdit=!1)}_editorUpdate(){let e=this.position;for(let t=0;t<3;t++)e[t]!=this._lastPosition[t]&&(this._lastPosition=e,this._interpolation&&this._interpolation.updateCurve())}static assetId="dedf4341-660f-46aa-b8d1-2c3c2ea3d534";static assetName="Control Point";static isPrivate=!0}if(H.registerAsset(ControlPoint),F.loadPrivate(ControlPoint),T){class ControlPointHelper extends B{constructor(e){super(e)}static fields=["position"]}V.registerEditorHelper(ControlPointHelper,ControlPoint)}const{EditorHelpers:O,LibraryHandler:R,ProjectHandler:Q,THREE:q,isEditor:z}=window.DigitalBacon,{EditorHelperFactory:G}=O,{AssetSetField:W,EnumField:U}=InterpolationHelper.FieldTypes,Y={Line:"line",Bezier:"bezier",Spline:"spline"},J=new q.Vector3;var X;class PositionInterpolation extends Interpolation{constructor(e={}){e.assetId=PositionInterpolation.assetId,super(e),this._curveType=e.curveType||"line",this._controlPoints=[],e.controlPoints?this.controlPoints=e.controlPoints:this.updateCurve()}_getDefaultName(){return PositionInterpolation.assetName}exportParams(){let e=super.exportParams();return e.controlPoints=this.controlPoints,e.curveType=this.curveType,e}getValue(e,t){let s=super.getValue(e,t);return s?(J.fromArray(s),this._keyframe._animationPath.object.localToWorld(J),J.toArray()):s}_getLinearValue(e,t){return"line"==this._curveType||0==this._controlPoints.length||e<0||e>1||!this._curve?J.copy(t.object.position).sub(this._keyframe.object.position).multiplyScalar(e).add(this._keyframe.object.position):this._curve.getPointAt(e,J),J.toArray()}_getStepValue(e,t){return e<1?this._keyframe.position:t.position}get controlPoints(){let e=[];for(let t of this._controlPoints)e.push(t.id);return e}get curveType(){return this._curveType}set controlPoints(e){for(let t of e)this.addControlPoint(t)}set curveType(e){this._curveType=e,this.updateCurve(),window.pi=this}addControlPoint(e){let t=Q.getAsset(e);t&&(this._controlPoints.push(t),t.registerInterpolation(this),this.updateCurve())}removeControlPoint(e){this._controlPoints.push(e);let t=Q.getAsset(e);if(!t)return;let s=this._controlPoints.indexOf(t);s>=0&&this._controlPoints.splice(s,1),this.updateCurve()}updateCurve(){let e=this._keyframe?._animationPath?.getNextKeyframeFor?.("position",this._keyframe),t=this._controlPoints.length;if(this._curveObject&&this._curveObject.parent.remove(this._curveObject),!e)return;if("line"==this._curveType||0==t)this._curve=new q.LineCurve3(this._keyframe.object.position,e.object.position);else if("bezier"==this._curveType)this._curve=1==t?new q.QuadraticBezierCurve3(this._keyframe.object.position,this._controlPoints[0].object.position,e.object.position):new q.CubicBezierCurve3(this._keyframe.object.position,this._controlPoints[0].object.position,this._controlPoints[1].object.position,e.object.position);else if("spline"==this._curveType){let t=[this._keyframe.object.position];for(let e of this._controlPoints)t.push(e.object.position);t.push(e.object.position),this._curve=new q.CatmullRomCurve3(t)}if(!z())return;let s=this._curve.getPoints(50),r=(new q.BufferGeometry).setFromPoints(s);X||(X=new q.LineDashedMaterial({color:16776960})),this._curveObject=new q.Line(r,X),this._keyframe._animationPath.object.add(this._curveObject)}static assetId="3dcb0b91-80fc-4aaf-aac4-a991521c906c";static assetName="Position Interpolation";static isPrivate=!0}Q.registerAsset(PositionInterpolation),R.loadPrivate(PositionInterpolation);G.registerEditorHelper(class extends InterpolationHelper{constructor(e){super(e)}static fields=["type","easing",{parameter:"curveType",name:"Curve Type",map:Y,type:U},{parameter:"controlPoints",name:"Control Points",addFunction:"addControlPoint",removeFunction:"removeControlPoint",newOptionsFunction:()=>[ControlPoint.assetId],type:W}]},PositionInterpolation);const{EditorHelpers:Z,LibraryHandler:$,ProjectHandler:ee,THREE:te}=window.DigitalBacon,{EditorHelperFactory:se}=Z,{CheckboxField:re,NumberField:ie}=InterpolationHelper.FieldTypes,ae=new te.Euler,oe=[new te.Quaternion,new te.Quaternion];class RotationInterpolation extends Interpolation{constructor(e={}){e.assetId=RotationInterpolation.assetId,super(e),this._useLongPath=e.useLongPath||!1,this._revolutions=e.revolutions||0}_getDefaultName(){return RotationInterpolation.assetName}exportParams(){let e=super.exportParams();return e.useLongPath=this._useLongPath,e.revolutions=this._revolutions,e}get useLongPath(){return this._useLongPath}get revolutions(){return this._revolutions}set useLongPath(e){this._useLongPath=e}set revolutions(e){this._revolutions=e}getValue(e,t){let s=super.getValue(e,t);return s?(ae.fromArray(s),oe[0].setFromEuler(ae),this._keyframe._animationPath.object.getWorldQuaternion(oe[1]).multiply(oe[0]),ae.setFromQuaternion(oe[1]),ae.toArray()):s}_getLinearValue(e,t){return oe[0].fromArray(this._slerpQuaternions(this._keyframe.object.quaternion,t.object.quaternion,e)),oe[0].normalize(),ae.setFromQuaternion(oe[0]),ae.toArray()}_slerpQuaternions(e,t,s){let r=e.normalize().toArray(),i=t.normalize().toArray(),a=r[0]*i[0]+r[1]*i[1]+r[2]*i[2]+r[3]*i[3],o=a<0?-1:1;this._revolutions%2==1&&(o*=-1);let n=-1===o?[-i[0],-i[1],-i[2],-i[3]]:i,l=Math.acos(a),d=l;this._revolutions&&(d=this._revolutions%2==0?this._revolutions*Math.PI+l:-this._revolutions*Math.PI-l);let p=Math.sin(d);if(Math.abs(p)<1e-6)return r;let c=Math.sin((1-s)*d),m=Math.sin(s*d);return[c*r[0]+m*n[0],c*r[1]+m*n[1],c*r[2]+m*n[2],c*r[3]+m*n[3]]}_getStepValue(e,t){return e<1?this._keyframe.rotation:t.rotation}static assetId="c8d59d21-88f1-4431-aefc-614b9ab58433";static assetName="Rotation Interpolation";static isPrivate=!0}ee.registerAsset(RotationInterpolation),$.loadPrivate(RotationInterpolation);se.registerEditorHelper(class extends InterpolationHelper{constructor(e){super(e)}static fields=["type","easing",{parameter:"useLongPath",name:"Long Path",type:re},{parameter:"revolutions",name:"Revolutions",min:0,type:ie}]},RotationInterpolation);const{LibraryHandler:ne,ProjectHandler:le,THREE:de}=window.DigitalBacon,pe=[new de.Vector3,new de.Vector3];class ScaleInterpolation extends Interpolation{constructor(e={}){e.assetId=ScaleInterpolation.assetId,super(e)}_getDefaultName(){return ScaleInterpolation.assetName}exportParams(){return super.exportParams()}getValue(e,t){let s=super.getValue(e,t);return s?(pe[0].fromArray(s),this._keyframe._animationPath.object.getWorldScale(pe[1]),pe[0].multiply(pe[1]),pe[0].toArray()):s}_getLinearValue(e,t){return pe[0].copy(t.object.scale).sub(this._keyframe.object.scale).multiplyScalar(e).add(this._keyframe.object.scale),pe[0].toArray()}_getStepValue(e,t){return e<1?this._keyframe.scale:t.scale}static assetId="ede2dc59-168a-4753-be2d-62530fcf7d67";static assetName="Scale Interpolation";static isPrivate=!0}le.registerAsset(ScaleInterpolation),ne.loadPrivate(ScaleInterpolation);const{EditorHelpers:ce,LibraryHandler:me,ProjectHandler:he}=window.DigitalBacon,{EditorHelperFactory:ue}=ce;class StepInterpolation extends Interpolation{constructor(e={}){e.assetId=StepInterpolation.assetId,super(e),this._type="step"}_getDefaultName(){return StepInterpolation.assetName}static assetId="6599906d-6fdc-4a51-9468-7e5eb3401b97";static assetName="Step Interpolation";static isPrivate=!0}he.registerAsset(StepInterpolation),me.loadPrivate(StepInterpolation);ue.registerEditorHelper(class extends InterpolationHelper{constructor(e){super(e)}static fields=[]},StepInterpolation);const{EditorHelpers:_e,LibraryHandler:fe,ProjectHandler:ge}=window.DigitalBacon,{EditorHelperFactory:ye}=_e;class TextInterpolation extends Interpolation{constructor(e={}){e.assetId=TextInterpolation.assetId,super(e),this._type="step"}_getDefaultName(){return TextInterpolation.assetName}static assetId="54593ea0-ace0-41d2-ac4a-4147a92356b7";static assetName="Text Interpolation";static isPrivate=!0}ge.registerAsset(TextInterpolation),fe.loadPrivate(TextInterpolation);ye.registerEditorHelper(class extends InterpolationHelper{constructor(e){super(e)}static fields=[]},TextInterpolation);const{LibraryHandler:Pe,ProjectHandler:Ie}=window.DigitalBacon;class VectorInterpolation extends Interpolation{constructor(e={}){e.assetId=VectorInterpolation.assetId,super(e)}_getDefaultName(){return VectorInterpolation.assetName}exportParams(){return super.exportParams()}_getLinearValue(e,t){let s=this._keyframe[this._parameter].slice(),r=t[this._parameter].slice();for(let t=0;t<s.length;t++)s[t]=(r[t]-s[t])*e+s[t];return s}static assetId="2ab2e72d-14ae-4f89-8b0b-ae23e7f7259b";static assetName="Vector Interpolation";static isPrivate=!0}Ie.registerAsset(VectorInterpolation),Pe.loadPrivate(VectorInterpolation);const{Assets:be,EditorHelpers:ve,LibraryHandler:Ae,ProjectHandler:Ee,PubSub:we,THREE:xe,getMenuController:Te,isEditor:Fe,utils:He}=window.DigitalBacon,{CustomAssetEntity:Ce}=be,{CustomAssetEntityHelper:je,EditorHelperFactory:ke}=ve,{AssetSetField:Se,ButtonField:Me,CheckboxField:Ne,ColorField:Be,EulerField:Ve,NumberField:Le,TextField:De,Vector2Field:Ke,Vector3Field:Oe}=je.FieldTypes,{numberOr:Re}=He;var Qe;new xe.Vector3,new xe.Vector3;const qe=new Set([Ne,Be,Ve,Le,De,Ke,Oe]),ze=["position","rotation","scale","renderOrder"],Ge={position:PositionInterpolation.assetId,rotation:RotationInterpolation.assetId,scale:ScaleInterpolation.assetId},We={ColorField:ColorInterpolation.assetId,EulerField:EulerInterpolation.assetId,NumberField:NumberInterpolation.assetId,TextField:TextInterpolation.assetId,Vector2Field:VectorInterpolation.assetId,Vector3Field:VectorInterpolation.assetId};class Keyframe extends Ce{constructor(e={}){e.assetId=Keyframe.assetId,super(e),this._time=Re(e.time,0),this.parameters={},this._interpolations=new Set,this._parameterInterpolations={},e.parameters&&this.setParameters(e.parameters),e.interpolations&&(this.interpolations=e.interpolations)}_createMesh(){if(!Fe())return;Qe||((Qe=(new xe.TextureLoader).load("https://cdn.jsdelivr.net/gh/kalegd/digitalbacon-plugins@latest/textures/Digital_Bacon_Piggy.jpg")).repeat.x=5,Qe.repeat.y=2.5,Qe.offset.x=-3.25,Qe.offset.y=-.75,Qe.colorSpace=xe.SRGBColorSpace);let e=new xe.SphereGeometry(.05),t=new xe.MeshBasicMaterial({color:16777215,map:Qe});this._mesh=new xe.Mesh(e,t),this._object.add(this._mesh)}_getDefaultName(){return Keyframe.assetName}exportParams(){let e=super.exportParams();return e.time=this._time,e.parameters=this.parameters,e.interpolations=this.interpolations,e}get interpolations(){let e=[];for(let t of this._interpolations)e.push(t.id);return e}get time(){return this._time}set interpolations(e){for(let t of e)this.addInterpolation(t)}set time(e){this._time=e,this._animationPath&&this._animationPath.updateKeyframes()}addInterpolation(e){let t=Ee.getAsset(e);t&&(this._interpolations.add(t),t.registerKeyframe(this),this._parameterInterpolations[t.parameter]=t)}addParameter(e,t){if(this.parameters[t]=e,this._animationPath&&this._animationPath.updateKeyframes(),ze.includes(e.parameter)){if(this._mesh||this._createMesh(),Fe()&&this._animationPath){let t=this._animationPath._animatedAssets.values().next().value;t&&(this[e.parameter]=t[e.parameter])}}else Object.defineProperty(this,e.parameter,{get:function(){return e.value},set:function(t){e.value=t}})}removeInterpolation(e){this._interpolations.push(e);let t=Ee.getAsset(e);t&&this._interpolations.delete(t)}setParameters(e){for(let t in e)this.addParameter(e[t],t)}registerAnimationPath(e){this._object.visible=!0,this._animationPath=e,this.parentId=e.id,this.visualEdit=e.visualEdit}unregisterAnimationPath(e){e==this._animationPath&&(this._object.visible=!1,this._animationPath=null,this.visualEdit=!1)}interpolate(e,t,s){return this._parameterInterpolations[e].getValue(t,s)}static assetId="401fcf91-49ef-480b-992d-e55ac0c65d4e";static assetName="Keyframe";static isPrivate=!0}if(Ee.registerAsset(Keyframe),Ae.loadPrivate(Keyframe),ve){class KeyframeHelper extends je{constructor(e){super(e),this._addParameterFields()}addParameter(){let e=this._asset._animationPath?._animatedAssets;if(e?.size){let t={};for(let s of e){let e=s.editorHelper;this._loadAssetParams(t,e.constructor)}let s=Te();s.getPage("ASSET_SELECT").setContent(t,(e=>{let r,i=t[e];this._asset.addParameter(i,e),this._menuFieldsMap[i.parameter]?r=this._menuFieldsMap[i.parameter]:(r=this._createStandardField(i),this._menuFieldsMap[i.parameter]=r),s.back();let a=s.getCurrentPage();a._removeCurrentFields(),this._menuFields.splice(this._menuFields.length-1,0,r),a.setAsset(this._asset,!0);let o=this._menuFields.length;for(;a._lastItemIndex+1!=o;)a._loadNextPage();this._createInterpolation(i)})),s.pushPage("ASSET_SELECT")}else we.publish(this._id,"MENU_NOTIFICATION",{text:"Please add an asset to the animation path first"})}_addParameterFields(){for(let e in this._asset.parameters){let t,s=this._asset.parameters[e];this._menuFields||this.getMenuFields(),this._menuFieldsMap[s.parameter]?t=this._menuFieldsMap[s.parameter]:(t=this._createStandardField(s),this._menuFieldsMap[s.parameter]=t),this._menuFields.splice(this._menuFields.length-1,0,t)}}_createInterpolation(e){let t,s={parameter:e.parameter,name:e.name};t=e.parameter in Ge?Ge[e.parameter]:e.type in We?We[e.type]:StepInterpolation.assetId;let r=Ee.addNewAsset(t,s);this._asset.addInterpolation(r.id)}_loadAssetParams(e,t){if(!t)return;let s=Object.getPrototypeOf(t);if(this._loadAssetParams(e,s),t.fields)for(let s of t.fields){if("string"==typeof s||!qe.has(s.type)||"visualEdit"==s.parameter)continue;let t=s.type.name+":"+s.parameter;t in e||t in this._asset.parameters||(e[t]=this._cloneField(s))}}_cloneField(e){let t={};for(let s in e)t[s]=e[s];return t.Name=t.name,t.type=t.type.name,t}static fields=[{parameter:"time",name:"Time",min:0,type:Le},{parameter:"interpolations",name:"Interpolations",addFunction:"addInterpolation",removeFunction:"removeInterpolation",type:Se},{parameter:"addParameter",name:"Add Parameter",type:Me}]}ke.registerEditorHelper(KeyframeHelper,Keyframe)}const{Assets:Ue,EditorHelpers:Ye,LibraryHandler:Je,ProjectHandler:Xe,Scene:Ze,THREE:$e,isEditor:et,isImmersionDisabled:tt}=window.DigitalBacon,{AssetEntity:st,CustomAssetEntity:rt}=Ue,{CustomAssetEntityHelper:it,EditorHelperFactory:at}=Ye,{AssetSetField:ot,ButtonField:nt,CheckboxField:lt}=it.FieldTypes;new $e.Euler;const dt=new $e.Quaternion,pt=new $e.Vector3;var ct,mt=0;class AnimationPath extends rt{constructor(e={}){e.assetId=AnimationPath.assetId,super(e),this._animatedAssets=new Set,this._keyframes=new Set,this._orderedKeyframes=[],this._orderedParameters={},this._maxTime=0,this._scrollBased=e.scrollBased||!1,e.animatedAssets&&(this.animatedAssets=e.animatedAssets),e.keyframes&&(this.keyframes=e.keyframes),et()||this._scrollBased&&tt()&&(this.update=this._updateScrollBased)}_getDefaultName(){return AnimationPath.assetName}exportParams(){let e=super.exportParams();return e.animatedAssets=this.animatedAssets,e.keyframes=this.keyframes,e.scrollBased=this.scrollBased,e}get animatedAssets(){let e=[];for(let t of this._animatedAssets)e.push(t.id);return e}get keyframes(){let e=[];for(let t of this._keyframes)e.push(t.id);return e}get scrollBased(){return this._scrollBased}set animatedAssets(e){for(let t of e)this.addAnimatedAsset(t)}set keyframes(e){for(let t of e)this.addKeyframe(t);this.updateKeyframes()}set scrollBased(e){this._scrollBased=e}addAnimatedAsset(e){let t=Xe.getAsset(e);t&&this._animatedAssets.add(t)}addKeyframe(e){let t=Xe.getAsset(e);t&&(this._keyframes.add(t),t.registerAnimationPath(this))}removeAnimatedAsset(e){let t=Xe.getAsset(e);t&&this._animatedAssets.delete(t)}removeKeyframe(e){let t=Xe.getAsset(e);t&&(this._keyframes.delete(t),t.unregisterAnimationPath(this))}getNextKeyframeFor(e,t){let s=this._orderedParameters[e];if(s)for(let e=0;e<s.length;e++){if(s[e]==t){if(e==s.length-1)return;return s[e+1]}}}updateKeyframes(){if(this._orderedParameters={},this._orderedKeyframes=Array.from(this._keyframes),this._orderedKeyframes=this._orderedKeyframes.sort(((e,t)=>e.time-t.time)),this._orderedKeyframes.length){for(let e of this._orderedKeyframes)for(let t in e.parameters){let s=e.parameters[t].parameter;this._orderedParameters[s]||(this._orderedParameters[s]=[]),this._orderedParameters[s].push(e)}this._maxTime=Math.max(0,this._orderedKeyframes[this._orderedKeyframes.length-1].time),this._scrollBased&&(mt=Math.max(mt,this._maxTime)),this._updatePositionInterpolationCurves()}}_updatePositionInterpolationCurves(){let e=this._orderedParameters.position;if(e)for(let t of e){let e=t._parameterInterpolations.position;e&&e.updateCurve()}}_setTime(e){for(let t in this._orderedParameters){let s,r=this._orderedParameters[t],i=r[0];for(let t=1;t<r.length&&(s=r[t],!(i.time<=e&&e<=s.time));t++)i=s,s=null;let a=i.interpolate(t,e,s);this._updateAssets(t,a)}}_updateAssets(e,t){for(let s of this._animatedAssets)if(s[e]=t,s instanceof st!=0)if("position"==e)s._object.parent.worldToLocal(s._object.position);else if("rotation"==e){let e=s._object.quaternion;e.setFromEuler(s._object.rotation),s._object.parent.getWorldQuaternion(dt),e.premultiply(dt.invert())}else"scale"==e&&(s._object.parent.getWorldScale(pt),s._object.scale.divide(pt))}_updateScrollBased(){let e=document.body.scrollHeight-window.innerHeight,t=window.scrollY,s=Math.min(Math.max(t/e,0),1);if(s==this._lastScrollPercent)return;this._lastScrollPercent=s;let r=s*mt;this._setTime(r)}static assetId="2d227485-0b34-40a4-873d-2a0782d034c6";static assetName="Animation Path";static getMaxTime(){return mt}}if(Xe.registerAsset(AnimationPath),Ye){function getAssets(){let e=Xe.getAssets(),t=[];for(let s in e){let r=e[s];"InternalAssetEntity"!=r.constructor.name&&(r.isPrivate||r.constructor.isPrivate||t.push(s))}return t}class AnimationPathHelper extends it{constructor(e){super(e)}preview(){ct?Ze.object.add(ct.object):((ct=new AnimationController).registerAnimationPathClass(AnimationPath),Ze.object.add(ct.object),at.addEditorHelperTo(ct),ct.editorHelper.updateVisualEdit(!0)),ct.setPositionFromMenu()}static fields=["visualEdit",{parameter:"scrollBased",name:"Scroll Based",type:lt},{parameter:"animatedAssets",name:"Assets",addFunction:"addAnimatedAsset",removeFunction:"removeAnimatedAsset",optionsFunction:getAssets,type:ot},{parameter:"keyframes",name:"Keyframes",addFunction:"addKeyframe",removeFunction:"removeKeyframe",newOptionsFunction:()=>[Keyframe.assetId],type:ot},{parameter:"preview",name:"Preview",type:nt},"position","rotation","scale"]}at.registerEditorHelper(AnimationPathHelper,AnimationPath)}export{AnimationPath as default};
